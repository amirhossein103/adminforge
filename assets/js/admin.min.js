(function($){'use strict';const AdminForge={init:function(){this.tabs();this.colorPicker();this.mediaUploader();this.conditionalLogic();this.repeaterField();},tabs:function(){$('.adminforge-tab').on('click',function(e){e.preventDefault();const $tab=$(this);const target=$tab.data('tab');$('.adminforge-tab').removeClass('active');$('.adminforge-tab-content').removeClass('active');$tab.addClass('active');$('#'+target).addClass('active');if(history.pushState){const url=new URL(window.location);url.searchParams.set('tab',target);window.history.pushState({},'',url);}});const urlParams=new URLSearchParams(window.location.search);const activeTab=urlParams.get('tab');if(activeTab){$('.adminforge-tab[data-tab="'+activeTab+'"]').trigger('click');}},colorPicker:function(){if($.fn.wpColorPicker){$('.adminforge-color-picker').wpColorPicker();}},mediaUploader:function(){let mediaFrame;$(document).on('click','.adminforge-upload-btn',function(e){e.preventDefault();const $button=$(this);const $input=$button.siblings('.adminforge-upload-input');const $preview=$button.siblings('.adminforge-upload-preview');if(!mediaFrame){mediaFrame=wp.media({title:adminforge.strings.select_image||'Select Image',button:{text:adminforge.strings.use_image||'Use Image'},multiple:false});}mediaFrame.on('select',function(){const attachment=mediaFrame.state().get('selection').first().toJSON();$input.val(attachment.url);if($preview.length){$preview.html('<img src="'+attachment.url+'" style="max-width: 200px;">');}});mediaFrame.open();});$(document).on('click','.adminforge-remove-upload',function(e){e.preventDefault();$(this).siblings('.adminforge-upload-input').val('');$(this).siblings('.adminforge-upload-preview').html('');});},conditionalLogic:function(){$('[data-condition]').each(function(){const $field=$(this);const condition=$field.data('condition');if(condition&&condition.field&&condition.value){const $trigger=$('#'+condition.field);AdminForge.checkCondition($field,$trigger,condition.value);$trigger.on('change',function(){AdminForge.checkCondition($field,$trigger,condition.value);});}});},checkCondition:function($field,$trigger,value){const triggerValue=$trigger.is(':checkbox')?$trigger.is(':checked'):$trigger.val();if(triggerValue==value){$field.slideDown();}else{$field.slideUp();}},repeaterField:function(){let rowIndex=0;if($.fn.sortable){$('.adminforge-repeater-sortable').sortable({handle:'.adminforge-repeater-handle',placeholder:'adminforge-repeater-placeholder',start:function(e,ui){ui.placeholder.height(ui.item.height());}});}$(document).on('click','.adminforge-repeater-add',function(e){e.preventDefault();const $button=$(this);const fieldId=$button.data('field-id');const $wrapper=$button.closest('.adminforge-repeater-wrapper');const $rows=$wrapper.find('.adminforge-repeater-rows');const maxRows=parseInt($wrapper.data('max-rows'))||50;const currentRows=$rows.find('.adminforge-repeater-row').length;if(currentRows>=maxRows){alert('Maximum rows reached');return;}const template=$('#'+fieldId+'-template').html();if(!template){return;}const newRow=template.replace(/\{\{INDEX\}\}/g,rowIndex);rowIndex++;$rows.append(newRow);$rows.trigger('adminforge:repeater:added',[fieldId]);});$(document).on('click','.adminforge-repeater-remove',function(e){e.preventDefault();const $button=$(this);const $row=$button.closest('.adminforge-repeater-row');const $rows=$row.closest('.adminforge-repeater-rows');const fieldId=$rows.data('field-id');if(confirm('Are you sure you want to remove this row?')){$row.fadeOut(300,function(){$(this).remove();$rows.trigger('adminforge:repeater:removed',[fieldId]);});}});},save:function(data,callback){$.ajax({url:adminforge.ajax_url,type:'POST',data:{action:'adminforge_save',nonce:adminforge.nonce,data:data},success:function(response){if(callback){callback(response);}},error:function(){alert(adminforge.strings.error);}});}};$(document).ready(function(){AdminForge.init();});window.AdminForge=AdminForge;})(jQuery);
